# Release Process & Auto-Updates

This document describes how releases are created and how the auto-update system works.

## Overview

Video Stitcher uses **GitHub Actions** to automatically build and release the application.
The app supports automatic updates through **electron-updater**, which checks for new versions on **GitHub Releases**.

**Important rule:**
üëâ **Git tags are the single source of truth for versions.**
You do **not** manually bump `package.json` for releases anymore.

---

## Creating a Release

### 1. Choose the Version

We follow semantic versioning:

* **Patch (Z)** ‚Äì bug fixes
  `0.2.18 ‚Üí 0.2.19`
* **Minor (Y)** ‚Äì new features
  `0.2.18 ‚Üí 0.3.0`
* **Major (X)** ‚Äì breaking changes (rare)
  `0.x ‚Üí 1.0.0`

### 2. (Optional) Create a Beta / Prerelease

Use prereleases to test without affecting normal users.

```bash
git tag -a v0.2.19-beta.1 -m "v0.2.19-beta.1"
git push origin v0.2.19-beta.1
```

* Automatically marked as **Prerelease**
* Only beta testers should receive it (via opt-in)

### 3. Create a Stable Release

When ready for everyone:

```bash
git tag -a v0.2.19 -m "v0.2.19"
git push origin v0.2.19
```

---

## What the CI Does Automatically

When a tag `v*` is pushed, the GitHub Actions workflow (`.github/workflows/build.yml`) will:

1. **Extract the version from the tag**

   * `v0.2.19` ‚Üí `0.2.19`
   * `v0.2.19-beta.1` ‚Üí `0.2.19-beta.1`

2. **Update `package.json` and `package-lock.json` in CI**

   * Uses `npm version --no-git-tag-version`
   * No commit is created
   * No retagging required

3. **Build the app for all platforms**

   * Windows (`.exe`, `.nupkg`, `RELEASES`)
   * macOS (`.zip`)
   * Linux (`.deb`, `.rpm`, `.zip`)

4. **Generate update metadata**

   * `latest.yml` (Windows)
   * `latest-mac.yml`
   * `latest-linux.yml`

5. **Create a GitHub Release**

   * Stable tag ‚Üí normal release
   * Tag with `-beta` / `-rc` ‚Üí prerelease
   * Never created as draft

---

## Auto-Update System

### How It Works

The app uses **electron-updater**:

1. **Check for updates**

   * On startup (after delay)
   * Periodically (every 4 hours by default)
2. **Download**

   * User is prompted before downloading
3. **Install**

   * After download, user can restart to apply the update

### Beta Updates (Opt-In)

Beta updates are **disabled by default**.

To enable beta updates (for testers/devs):

```bash
VIDEO_STITCHER_BETA_UPDATES=1
```

When enabled:

* Prerelease versions (`-beta`, `-rc`) are allowed
* Stable users are not affected

---

## Metadata Files

The workflow generates metadata files used by `electron-updater`:

### `latest.yml` (Windows)

Includes installer + `.nupkg` references.

### `latest-mac.yml` (macOS)

Includes macOS zip.

### `latest-linux.yml` (Linux)

Includes Linux zip.

‚ö†Ô∏è **Windows also requires `RELEASES`**, which is generated by Squirrel and uploaded by CI.

---

## Testing Auto-Updates

### Stable ‚Üí Stable

1. Install version A (e.g. `0.2.18`)
2. Release version B (`v0.2.19`)
3. Run version A
4. Update prompt should appear

### Stable ‚Üí Beta

1. Install stable version
2. Enable beta updates:

   ```bash
   VIDEO_STITCHER_BETA_UPDATES=1
   ```
3. Release `v0.2.19-beta.1`
4. Update prompt should appear

---

## Troubleshooting

### Updates Not Working?

1. **Check version**
   Settings ‚Üí About
2. **Check logs**

   * Windows: `%APPDATA%\VideoStitcher\logs\`
3. **Check release**

   * Must be published (not draft)
   * Must include `latest*.yml`
   * Windows must include `RELEASES`
4. **Network**

   * GitHub downloads must be reachable

‚ö†Ô∏è Older versions with a broken updater may require **one manual install** to get back on the update path.

---

## Important Rules

* ‚ùå Do not manually bump `package.json` for releases
* ‚ùå Do not retag existing versions
* ‚úÖ Always create a new tag
* ‚úÖ Use prereleases for testing
* ‚úÖ CI handles versioning and packaging

---

## References

* electron-updater documentation
* GitHub Actions workflow: `.github/workflows/build.yml`
* Update metadata generator: `scripts/generate-latest-yml.cjs`