# Release Process & Auto-Updates

This document describes how releases are created and how the auto-update system works.

## Overview

Reco Video Stitcher uses GitHub Actions to automatically build and release the application. The app supports automatic updates through `electron-updater`, which checks for new versions on GitHub releases.

## Creating a Release

### 1. Update Version

Update the version in `package.json`:

```bash
npm version patch  # For bug fixes (0.2.17 -> 0.2.18)
npm version minor  # For new features (0.2.17 -> 0.3.0)
npm version major  # For breaking changes (0.2.17 -> 1.0.0)
```

This will automatically create a git tag.

### 2. Push the Tag

```bash
git push origin v0.2.18  # Replace with your version
```

### 3. Automated Build

The GitHub Actions workflow (`.github/workflows/build.yml`) will:

1. Build the app for Windows, macOS, and Linux
2. Generate installer packages (`.exe`, `.zip`, `.deb`, `.rpm`)
3. **Generate `latest.yml`, `latest-mac.yml`, and `latest-linux.yml` metadata files**
4. Create a draft GitHub release with all artifacts

### 4. Publish the Release

1. Go to [GitHub Releases](https://github.com/reco-project/video-stitcher/releases)
2. Edit the draft release
3. Add release notes
4. Publish the release

## Auto-Update System

### How It Works

The app uses `electron-updater` to check for updates from GitHub releases:

1. **Check for Updates**: Every 4 hours (configurable) and on startup
2. **Download**: If a new version is available, user is prompted to download
3. **Install**: After download, user can install immediately or on next restart

### Configuration

Auto-update is configured in:
- **`electron/updater.js`**: Main auto-updater logic
- **`frontend/src/features/settings/components/AppSettings.jsx`**: User settings UI
- **`electron/settings.js`**: Settings persistence

Users can enable/disable auto-updates in **Settings → Updates**.

### Metadata Files

The workflow generates three metadata files that electron-updater uses to detect new versions:

#### `latest.yml` (Windows)
```yaml
version: 0.2.17
files:
  - url: Video-Stitcher-Setup-0.2.17.exe
    sha512: <hash>
    size: <bytes>
  - url: Video-Stitcher-0.2.17-full.nupkg
    sha512: <hash>
    size: <bytes>
path: Video-Stitcher-Setup-0.2.17.exe
sha512: <hash>
releaseDate: '2024-01-31T00:00:00.000Z'
```

#### `latest-mac.yml` (macOS)
```yaml
version: 0.2.17
files:
  - url: Video-Stitcher-darwin-arm64-0.2.17.zip
    sha512: <hash>
    size: <bytes>
path: Video-Stitcher-darwin-arm64-0.2.17.zip
sha512: <hash>
releaseDate: '2024-01-31T00:00:00.000Z'
```

#### `latest-linux.yml` (Linux)
```yaml
version: 0.2.17
files:
  - url: Video-Stitcher-linux-x64-0.2.17.zip
    sha512: <hash>
    size: <bytes>
path: Video-Stitcher-linux-x64-0.2.17.zip
sha512: <hash>
releaseDate: '2024-01-31T00:00:00.000Z'
```

These files are automatically generated by `scripts/generate-latest-yml.cjs` during the build process.

## Manual Release (if needed)

If you need to create a release manually:

```bash
# Build for your platform
npm run electron-make

# Generate latest yml files
node scripts/generate-latest-yml.cjs

# Upload artifacts to GitHub release manually
# Files are in: out/make/
```

## Testing Auto-Updates

To test auto-updates locally:

1. Build and release version A (e.g., 0.2.17)
2. Install it on your machine
3. Build and release version B (e.g., 0.2.18)
4. Run version A and wait for the update check
5. You should see a prompt to download version B

## Troubleshooting

### Updates Not Working?

1. **Check Settings**: Make sure auto-update is enabled in Settings → Updates
2. **Check Console**: Look for `[Updater]` logs in the Electron console
3. **Check Release**: Ensure the release is published (not draft) and includes the `latest*.yml` files
4. **Check Network**: Some networks may block GitHub downloads

### Manual Update Check

Users can manually trigger an update check from the Help menu (if implemented) or by restarting the app.

## Security

- All downloads are verified using SHA512 checksums
- Downloads are only fetched from official GitHub releases
- Code signing is recommended (see Windows certificate setup in workflow)

## References

- [electron-updater documentation](https://www.electron.build/auto-update)
- [GitHub Actions workflow](.github/workflows/build.yml)
- [Update script](scripts/generate-latest-yml.cjs)
